<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ваза Доброго Врядування v6.0.1</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap');

body {
  margin: 0;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #f0f4f8;
  font-family: 'Montserrat', sans-serif;
  cursor: none;
}

.scene {
  position: relative;
  width: 900px;
  height: 700px;
  background: #e9edf2;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.12);
  overflow: hidden;
  user-select: none;
}
.ceiling, .floor {
  position: absolute;
  left: 0;
  width: 100%;
  height: 25px;
  background: #d1d9e6;
  box-shadow: inset 0 3px 6px rgba(0,0,0,0.1);
  z-index: 10;
}
.ceiling { top: 0; }
.floor { bottom: 0; box-shadow: inset 0 -3px 6px rgba(0,0,0,0.1); }

.svg-canvas {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

#ropeGroup {
    z-index: 5;
}

#vaseGroup {
    z-index: 15;
}

.vase-group {
  filter: drop-shadow(0 10px 18px rgba(0,0,0,0.15));
  transition: transform 0.8s cubic-bezier(0.6, 0.04, 0.98, 0.335);
  pointer-events: none;
}
.vase-main {
  filter: url(#vaseShine);
  stroke: #406fb5;
  stroke-width: 3;
  fill: url(#vaseGradient);
}
.vase-text {
  fill: white;
  font-weight: 700;
  font-size: 22px;
  user-select: none;
}

/* ВИПРАВЛЕННЯ: Повертаємо просту, але надійну заливку для мотузок */
.rope-path {
  fill: none;
  stroke: #8f5500;
  stroke-width: 5; /* Трохи товщі для кращої видимості */
  stroke-linecap: round;
  transition: opacity 0.4s ease;
}

.rope-text {
  font-size: 18px;
  font-weight: 600;
  fill: #3d5a80;
  pointer-events: none;
}
.shard {
  position: absolute;
  background: linear-gradient(135deg, #a8c4e8, #5a82be);
  opacity: 1;
  pointer-events: none;
  border-radius: 50% 40% 30% 70% / 60% 40% 50% 40%;
  transition: transform 1.2s cubic-bezier(0.1, 0.7, 0.3, 1), opacity 1.2s linear;
  z-index: 18;
}
.button-container, .message {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  text-align: center;
  z-index: 25;
}
.button-container {
  bottom: 30px;
}
.message {
  top: 50%;
  transform: translate(-50%, -50%);
  font-size: 24px;
  font-weight: 700;
  padding: 20px 40px;
  border-radius: 12px;
  background: rgba(255,255,255,0.95);
  box-shadow: 0 8px 25px rgba(0,0,0,0.1);
  display: none;
}
.button {
  padding: 14px 30px;
  font-size: 18px;
  font-weight: 700;
  cursor: pointer;
  border: none;
  border-radius: 50px;
  color: white;
  background-color: #3d7ab8;
  box-shadow: 0 5px 20px rgba(61,122,184,0.45);
  transition: all 0.3s ease;
  margin: 0 15px;
}
.button:hover {
  transform: translateY(-3px);
  box-shadow: 0 7px 30px rgba(61,122,184,0.55);
}
#tryAgainBtn {
  background-color: #d9534f;
  box-shadow: 0 5px 20px rgba(217,83,79,0.45);
  display: none;
}
#scissors-cursor {
  position: fixed;
  width: 44px;
  height: 44px;
  pointer-events: none;
  z-index: 9999;
  transform: translate(-50%, -50%);
  transition: opacity 0.25s ease;
}
#scissors-cursor.hidden {
  opacity: 0;
}
#scissors-cursor svg {
  width: 100%;
  height: 100%;
  filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.35));
}
#scissors-cursor.clicking svg {
  animation: scissors-cut-anim 0.3s ease-in-out;
}
@keyframes scissors-cut-anim {
  0% { transform: scale(1) rotate(0deg); }
  50% { transform: scale(1.2) rotate(15deg); }
  100% { transform: scale(1) rotate(0deg); }
}
.rope-half {
  fill: none;
  stroke: #8f5500;
  stroke-width: 5;
  stroke-linecap: round;
  transition: d 1s cubic-bezier(0.6, 0.04, 0.2, 1), opacity 1s;
}
</style>
</head>
<body>
<div class="scene" id="scene">
  <div class="ceiling"></div>
  <svg class="svg-canvas" id="svgCanvas">
    <defs id="svg-defs">
      <linearGradient id="vaseGradient" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#a8c4e8; stop-opacity:1" />
        <stop offset="100%" style="stop-color:#5a82be; stop-opacity:1" />
      </linearGradient>
      <filter id="vaseShine" x="-50%" y="-50%" width="200%" height="200%">
        <feGaussianBlur in="SourceAlpha" stdDeviation="3" result="blur" />
        <feOffset in="blur" dx="2" dy="2" result="offsetBlur" />
        <feSpecularLighting in="blur" surfaceScale="5" specularConstant=".75" specularExponent="20" lighting-color="#ffffff" result="specOut">
          <fePointLight x="-5000" y="-10000" z="20000" />
        </feSpecularLighting>
        <feComposite in="specOut" in2="SourceAlpha" operator="in" result="specOut" />
        <feComposite in="SourceGraphic" in2="specOut" operator="arithmetic" k1="0" k2="1" k3="1" k4="0" result="litPaint" />
        <feMerge>
          <feMergeNode in="offsetBlur" />
          <feMergeNode in="litPaint" />
        </feMerge>
      </filter>
    </defs>
    <g id="ropeGroup" style="z-index: 5;"></g>
    <g class="vase-group" id="vaseGroup" transform="translate(450, 350)" style="z-index: 15;">
      <path class="vase-main" d="M -90,-120 C -110,-80 -110,-40 -85,20 L -75,140 C -65,165 65,165 75,140 L 85,20 C 110,-40 110,-80 90,-120 C 65,-150 -65,-150 -90,-120 Z"/>
      <text class="vase-text" x="0" y="30" text-anchor="middle">Добре</text>
      <text class="vase-text" x="0" y="70" text-anchor="middle">врядування</text>
    </g>
  </svg>
  <div class="floor"></div>
  <div class="button-container">
    <button id="checkBtn" class="button">Перевірити</button>
    <button id="tryAgainBtn" class="button">Спробувати ще</button>
  </div>
  <div class="message" id="message"></div>
</div>
<div id="scissors-cursor">
  <svg viewBox="0 0 24 24" fill="none" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="6" cy="6" r="3" />
    <circle cx="6" cy="18" r="3" />
    <line x1="20" y1="4" x2="8.12" y2="15.88" />
    <line x1="14.47" y1="14.48" x2="20" y2="20" />
    <line x1="8.12" y1="8.12" x2="12" y2="12" />
  </svg>
</div>
<script>
  const principles = [
    'Участь', 'Верховенство права', 'Прозорість', 'Чуйність',
    'Консенсус', 'Інклюзивність', 'Ефективність', 'Підзвітність',
    'Стратегічне бачення', 'Компетентність', 'Інновації', 'Сталість'
  ];

  const scene = document.getElementById('scene');
  const svgDefs = document.getElementById('svg-defs');
  const ropeGroup = document.getElementById('ropeGroup');
  const vaseGroup = document.getElementById('vaseGroup');
  const checkBtn = document.getElementById('checkBtn');
  const tryAgainBtn = document.getElementById('tryAgainBtn');
  const message = document.getElementById('message');
  const scissorsCursor = document.getElementById('scissors-cursor');

  const VASE_INITIAL_Y = 350;
  let ropes = [];

  const breakSound = new Audio('https://cdn.freesound.org/previews/331/331912_5487369-lq.mp3');
  breakSound.preload = 'auto';

  function initAudio() {
    breakSound.play().then(() => breakSound.pause()).catch(() => {});
    document.body.removeEventListener('click', initAudio);
  }
  document.body.addEventListener('click', initAudio, { once: true });

  window.addEventListener('mousemove', e => {
    scissorsCursor.style.left = `${e.clientX}px`;
    scissorsCursor.style.top = `${e.clientY}px`;
  });

  [checkBtn, tryAgainBtn].forEach(btn => {
    btn.addEventListener('mouseenter', () => scissorsCursor.classList.add('hidden'));
    btn.addEventListener('mouseleave', () => scissorsCursor.classList.remove('hidden'));
  });

  function createRope(i) {
    const numRopes = principles.length;
    const ceilingY = 25;
    const ceilingSpread = 850;
    const vaseRopeAttachY = VASE_INITIAL_Y - 120;
    const vaseRopeAttachSpread = 180;

    const rope = {};
    const x1 = 450 + (i - (numRopes - 1)/2) * (vaseRopeAttachSpread / (numRopes -1));
    const y1 = vaseRopeAttachY;
    const x2 = (scene.clientWidth - ceilingSpread)/2 + i*(ceilingSpread/(numRopes -1));
    const y2 = ceilingY;

    const textPathId = `text-path-def-${i}`;
    const isFlipped = x2 < x1;

    const textPathDef = document.createElementNS('http://www.w3.org/2000/svg','path');
    textPathDef.setAttribute('id', textPathId);
    textPathDef.setAttribute('d', isFlipped ? `M${x2},${y2} L${x1},${y1}` : `M${x1},${y1} L${x2},${y2}`);
    svgDefs.appendChild(textPathDef);

    const g = document.createElementNS('http://www.w3.org/2000/svg','g');
    
    const path = document.createElementNS('http://www.w3.org/2000/svg','path');
    path.setAttribute('d', `M${x1},${y1} L${x2},${y2}`);
    path.classList.add('rope-path');

    const clickArea = document.createElementNS('http://www.w3.org/2000/svg','path');
    clickArea.setAttribute('d', `M${x1},${y1} L${x2},${y2}`);
    clickArea.setAttribute('style', 'fill:none; stroke:transparent; stroke-width:30px; pointer-events:auto; cursor:none;');

    const text = document.createElementNS('http://www.w3.org/2000/svg','text');
    text.classList.add('rope-text');
    const textPath = document.createElementNS('http://www.w3.org/2000/svg','textPath');
    textPath.setAttributeNS('http://www.w3.org/1999/xlink','xlink:href', `#${textPathId}`);
    textPath.setAttribute('startOffset','55%');
    textPath.setAttribute('text-anchor','middle');
    textPath.setAttribute('dy', isFlipped ? '22' : '-18');
    textPath.textContent = principles[i];

    text.appendChild(textPath);
    g.appendChild(path);
    g.appendChild(text);
    g.appendChild(clickArea);
    ropeGroup.appendChild(g);

    rope.group = g;
    rope.cut = false;

    clickArea.addEventListener('click', () => {
      if(rope.cut) return;
      rope.cut = true;
      g.style.transition = 'opacity 0.4s';
      g.style.opacity = '0';
      
      scissorsCursor.classList.add('clicking');
      setTimeout(() => scissorsCursor.classList.remove('clicking'), 300);
      
      animateCutRope(x1, y1, x2, y2);
    });

    return rope;
  }

  function animateCutRope(x1, y1, x2, y2) {
    const midX = (x1 + x2) / 2;
    const midY = (y1 + y2) / 2;
    const half1 = document.createElementNS('http://www.w3.org/2000/svg','path');
    half1.setAttribute('d', `M${x1},${y1} L${midX},${midY}`);
    half1.classList.add('rope-half');
    
    const half2 = document.createElementNS('http://www.w3.org/2000/svg','path');
    half2.setAttribute('d', `M${midX},${midY} L${x2},${y2}`);
    half2.classList.add('rope-half');
    
    ropeGroup.appendChild(half1);
    ropeGroup.appendChild(half2);
    
    requestAnimationFrame(() => {
      half1.setAttribute('d', `M${x1},${y1} Q${x1},${y1+70} ${midX},${midY+70}`);
      half2.setAttribute('d', `M${x2},${y2} Q${x2},${y2+70} ${midX},${midY+70}`);
      half1.style.opacity = '0';
      half2.style.opacity = '0';
    });
    
    setTimeout(() => {
      half1.remove();
      half2.remove();
    }, 1000);
  }

  function resetScene() {
    ropeGroup.innerHTML = '';
    svgDefs.innerHTML = ''; // Очищуємо defs, щоб уникнути дублювання
    
    ropes = principles.map((_,i) => createRope(i));
    
    vaseGroup.style.transition = 'none';
    vaseGroup.setAttribute('transform', `translate(450, ${VASE_INITIAL_Y})`);
    vaseGroup.classList.remove('shattered');
    message.style.display = 'none';
    tryAgainBtn.style.display = 'none';
    checkBtn.style.display = 'inline-block';
    document.querySelectorAll('.shard').forEach(s => s.remove());
  }

  function createShards(){
    const vaseRect = vaseGroup.getBoundingClientRect();
    const sceneRect = scene.getBoundingClientRect();
    for(let i=0; i<15; i++){
      const shard = document.createElement('div');
      shard.className = 'shard';
      const size = 10 + Math.random() * 25;
      shard.style.width = `${size}px`;
      shard.style.height = `${size}px`;
      shard.style.left = `${vaseRect.left - sceneRect.left + vaseRect.width / 2 - size / 2}px`;
      shard.style.top = `${vaseRect.top - sceneRect.top + vaseRect.height / 2 - size / 2}px`;
      scene.appendChild(shard);
      const angle = Math.random() * Math.PI * 2;
      const distance = 100 + Math.random() * 150;
      const x = Math.cos(angle) * distance;
      const y = Math.sin(angle) * distance + 50;
      const rot = (Math.random() - 0.5) * 720;
      requestAnimationFrame(() => {
        shard.style.transform = `translate(${x}px, ${y}px) rotate(${rot}deg)`;
        shard.style.opacity = '0';
      });
      setTimeout(() => shard.remove(), 1200);
    }
  }

  checkBtn.addEventListener('click', () => {
    const cutCount = ropes.filter(r => r.cut).length;
    if (cutCount === 0) {
      message.textContent = 'Система стабільна!';
      message.style.color = '#28a745';
      message.style.display = 'block';
      setTimeout(() => { message.style.display = 'none'; }, 2000);
    } else {
      let floorY = scene.clientHeight - 160;
      vaseGroup.style.transition = 'transform 0.8s cubic-bezier(0.6, -0.28, 0.735, 0.045)';
      vaseGroup.setAttribute('transform',`translate(450, ${floorY})`);
      setTimeout(() => {
        breakSound.currentTime = 0;
        breakSound.play();
        vaseGroup.classList.add('shattered');
        createShards();
      }, 800);
      setTimeout(() => {
        checkBtn.style.display = 'none';
        tryAgainBtn.style.display = 'inline-block';
        message.textContent = 'Втрата навіть одного принципу руйнує систему. 💥';
        message.style.color = '#d9534f';
        message.style.display = 'block';
      }, 900);
    }
  });

  tryAgainBtn.addEventListener('click', resetScene);

  resetScene();
</script>
</body>
</html>
